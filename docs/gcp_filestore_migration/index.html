<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/silta/blog/rss.xml" title="Silta Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/silta/blog/atom.xml" title="Silta Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Silta" href="/silta/opensearch.xml"><title data-react-helmet="true">gcp_filestore_migration | Silta</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="gcp_filestore_migration | Silta"><meta data-react-helmet="true" name="description" content="Replace file storage with Google&#x27;s Filestore volume."><meta data-react-helmet="true" property="og:description" content="Replace file storage with Google&#x27;s Filestore volume."><meta data-react-helmet="true" property="og:url" content="https://silta.wunder.io/silta/docs/gcp_filestore_migration"><link data-react-helmet="true" rel="shortcut icon" href="/silta/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://silta.wunder.io/silta/docs/gcp_filestore_migration"><link rel="stylesheet" href="/silta/styles.152cdccf.css">
<link rel="preload" href="/silta/styles.4d755ee7.js" as="script">
<link rel="preload" href="/silta/runtime~main.5c899479.js" as="script">
<link rel="preload" href="/silta/main.b4e2b72a.js" as="script">
<link rel="preload" href="/silta/1.5f155a16.js" as="script">
<link rel="preload" href="/silta/2.429058cd.js" as="script">
<link rel="preload" href="/silta/33.42ebe109.js" as="script">
<link rel="preload" href="/silta/36.772ffc42.js" as="script">
<link rel="preload" href="/silta/935f2afb.6572eb8b.js" as="script">
<link rel="preload" href="/silta/17896441.7736293f.js" as="script">
<link rel="preload" href="/silta/09cd909c.de1e0648.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/silta/"><img src="/silta/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/silta/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/silta/docs/anatomy-of-silta">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wunderio/silta" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/silta/"><img src="/silta/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/silta/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/silta/docs/anatomy-of-silta">Docs</a></li><li class="menu__list-item"><a href="https://github.com/wunderio/silta" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">gcp_filestore_migration</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="replace-file-storage-with-googles-filestore-volume"></a>Replace file storage with Google&#x27;s Filestore volume.<a class="hash-link" href="#replace-file-storage-with-googles-filestore-volume" title="Direct link to heading">#</a></h1><p>This example will change storage for Drupal public files.
Repeat the same steps for other volumes, such as private files.</p><p>This will first add a new mount for the new Google filestore to <code>/app/web/sites/default/files-new</code> where the files from the existing object storage <code>public-files</code> mount <code>/app/web/sites/default/files</code> are copied from and then the new filestore is mounted to the existing <code>/app/web/sites/default/files</code> mount at the same time when the old <code>public-files</code> mount is disabled.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="-limitations-pitfalls"></a>!! LIMITATIONS, PITFALLS<a class="hash-link" href="#-limitations-pitfalls" title="Direct link to heading">#</a></h3><ol><li>Do not delete the old public-files section, nor change their names. Kubernetes tracks the volumes by these names.</li><li>Do not change storage size after the first deployment. You will end up in an error state: Ignoring the PVC: didn&#x27;t find a plugin capable of expanding the volume; waiting for an external controller to process this PVC.</li><li>The provisioned storage limit is not enforced. The application can expand to use all the available storage regardless of the provisioned size.
If you run out of free space on volume, contact cluster administrator for its expansion.</li><li>The provisioned storage is not guaranteed. You may allocate more than the NFS share&#x27;s total size. The share may also not have enough storage space left to actually accommodate the request.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="changing-storage-for-an-existing-environment"></a>Changing storage for an existing environment:<a class="hash-link" href="#changing-storage-for-an-existing-environment" title="Direct link to heading">#</a></h2><ol><li><p>Add a new location which uses the new storage. We will extend default values from <a href="https://github.com/wunderio/charts/blob/039f29d9d507813d40a182fa2320adfd6a3db06a/drupal/values.yaml#L355" target="_blank" rel="noopener noreferrer">https://github.com/wunderio/charts/blob/039f29d9d507813d40a182fa2320adfd6a3db06a/drupal/values.yaml#L355</a></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">public-files-filestore</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10G</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /app/web/sites/default/files</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">new</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shared</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Deploy</p></li><li><p>Find and exec into the shell deployment to get root access</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">kubectl --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> get deployments </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> shell</span></div><div class="token-line" style="color:#393A34"><span class="token plain">kubectl --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> -it deployment/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">shell deployment name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> -- </span><span class="token function" style="color:#d73a49">sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Copy public files from the old location to the new one</p><p> 4.1. Simple way, for small amounts of files:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> --info</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">progress2 -az /app/web/sites/default/files/ /app/web/sites/default/files-new/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> 4.2. Advanced way, for large amounts of files:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /app/web/sites/default/files</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"> -maxdepth </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -mindepth </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -type d </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> -P15 -I% </span><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> --relative --info</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">progress2 -az % /app/web/sites/default/files-new/ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"> -maxdepth </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -mindepth </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -type f  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> -P15 -I% </span><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> --relative --info</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">progress2 -az % /app/web/sites/default/files-new/ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"> -maxdepth </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> -mindepth </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> -type f  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> -P15 -I% </span><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> --relative --info</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">progress2 -az % /app/web/sites/default/files-new/</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Verify file count matches in both directories</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> /app/web/sites/default/files/ </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wc</span><span class="token plain"> -l </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> /app/web/sites/default/files-new/ </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wc</span><span class="token plain"> -l</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Set ownership and permissions for the new location</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/app/web/sites/default/files-new</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> -R www-data:www-data </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">770</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -type d -print0 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> -0 --max-args</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">770</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -type f -print0 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> -0 --max-args</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">660</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Update the mount path for the new mount, disable the old one</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">public-files-filestore</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10G</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /app/web/sites/default/files</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shared</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">public-files</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /app/web/sites/default/files</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">old</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Add the original Drupal file paths as environment variables (ignore the private files path if the project doesn&#x27;t have private file system enabled)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">php</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">PRIVATE_FILES_PATH</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /app/private</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">PUBLIC_FILES_PATH</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /app/web/sites/default/files</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>To run PHP as user <code>www-data</code>, add this line in your <code>silta/php.Dockerfile</code> right after the <code>COPY</code> line</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dockerfile codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">USER www-data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Dockerfile example of a project</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dockerfile codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">FROM wunderio/silta-php-fpm:8.0-fpm-v1</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=www-data:www-data . /app</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">USER www-data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Deploy</p></li><li><p>Check owners of the files directory, it should be www-data</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> -alh /app/web/sites/default/files</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If some of the files are owned by root - rerun step 5, but for the files path (not files-new)</p></li><li><p>Check that the public files path shows up correctly when running <code>drush status</code>.
If it doesn&#x27;t, make sure that it has not been overridden in settings.php file.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="changing-storage-for-a-new-deployment-project"></a>Changing storage for a new deployment, project:<a class="hash-link" href="#changing-storage-for-a-new-deployment-project" title="Direct link to heading">#</a></h2><ol><li>Redefine the default public and private files volumes.</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">public-files</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10G</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /app/web/sites/default/files</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shared</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">private-files</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1G</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /app/private</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shared</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="2"><li>Deploy - this is your first deployment for the project or environment.</li></ol></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/wunderio/silta/tree/master/docs/gcp_filestore_migration.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#-limitations-pitfalls" class="table-of-contents__link">!! LIMITATIONS, PITFALLS</a></li><li><a href="#changing-storage-for-an-existing-environment" class="table-of-contents__link">Changing storage for an existing environment:</a></li><li><a href="#changing-storage-for-a-new-deployment-project" class="table-of-contents__link">Changing storage for a new deployment, project:</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/silta/docs/">Style Guide</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social presence</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/wunder.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/wunder.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin</a></li><li class="footer__item"><a href="https://twitter.com/Wunder_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.instagram.com/wunder.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCsBoaJt5sX12IFBu1giXZJg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://wunder.io/articles/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/wunderio/silta" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Wunder</div></div></div></footer></div>
<script src="/silta/styles.4d755ee7.js"></script>
<script src="/silta/runtime~main.5c899479.js"></script>
<script src="/silta/main.b4e2b72a.js"></script>
<script src="/silta/1.5f155a16.js"></script>
<script src="/silta/2.429058cd.js"></script>
<script src="/silta/33.42ebe109.js"></script>
<script src="/silta/36.772ffc42.js"></script>
<script src="/silta/935f2afb.6572eb8b.js"></script>
<script src="/silta/17896441.7736293f.js"></script>
<script src="/silta/09cd909c.de1e0648.js"></script>
</body>
</html>