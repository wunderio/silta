<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/silta/blog/rss.xml" title="Silta Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/silta/blog/atom.xml" title="Silta Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Silta" href="/silta/opensearch.xml"><title data-react-helmet="true">Silta examples | Silta</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Silta examples | Silta"><meta data-react-helmet="true" name="description" content="silta.yml configuration examples"><meta data-react-helmet="true" property="og:description" content="silta.yml configuration examples"><meta data-react-helmet="true" property="og:url" content="https://silta.wunder.io/silta/docs/silta-examples"><link data-react-helmet="true" rel="shortcut icon" href="/silta/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://silta.wunder.io/silta/docs/silta-examples"><link rel="stylesheet" href="/silta/styles.152cdccf.css">
<link rel="preload" href="/silta/styles.4d755ee7.js" as="script">
<link rel="preload" href="/silta/runtime~main.c8bce8dc.js" as="script">
<link rel="preload" href="/silta/main.f8febef0.js" as="script">
<link rel="preload" href="/silta/1.5f155a16.js" as="script">
<link rel="preload" href="/silta/2.429058cd.js" as="script">
<link rel="preload" href="/silta/33.42ebe109.js" as="script">
<link rel="preload" href="/silta/36.772ffc42.js" as="script">
<link rel="preload" href="/silta/935f2afb.6572eb8b.js" as="script">
<link rel="preload" href="/silta/17896441.7736293f.js" as="script">
<link rel="preload" href="/silta/5a2b91a1.f6c4c79f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/silta/"><img src="/silta/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/silta/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/silta/docs/anatomy-of-silta">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wunderio/silta" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/silta/"><img src="/silta/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/silta/img/logo.svg" alt="Wunder Silta" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/silta/docs/anatomy-of-silta">Docs</a></li><li class="menu__list-item"><a href="https://github.com/wunderio/silta" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/anatomy-of-silta">Silta project build process</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/circleci-conf-examples">CircleCI configuration examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/creating-new-project">Creating a new project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/deployment-workflow">Deployment workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/docker-images">Docker images</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/encrypting-sensitive-configuration">Encrypting sensitive configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/go-live-checklist">Go-live checklist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/help-with-silta-dev">Helping with Silta development</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/key-components">Key components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/migrating-an-existing-drupal-project">Migrating an existing Drupal project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/request-workflow">Request workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/configuring-cdn">Configuring CDN</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/silta/docs/silta-examples">Silta examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/silta/docs/troubleshooting">Troubleshooting</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Silta examples</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="siltayml-configuration-examples"></a>silta.yml configuration examples<a class="hash-link" href="#siltayml-configuration-examples" title="Direct link to heading">#</a></h2><p>The default values are documented here:</p><ul><li>Drupal chart: <a href="https://github.com/wunderio/charts/blob/master/drupal/values.yaml" target="_blank" rel="noopener noreferrer">https://github.com/wunderio/charts/blob/master/drupal/values.yaml</a></li><li>Frontend chart: <a href="https://github.com/wunderio/charts/blob/master/frontend/values.yaml" target="_blank" rel="noopener noreferrer">https://github.com/wunderio/charts/blob/master/frontend/values.yaml</a></li><li>Simple chart: <a href="https://github.com/wunderio/charts/blob/master/simple/values.yaml" target="_blank" rel="noopener noreferrer">https://github.com/wunderio/charts/blob/master/simple/values.yaml</a></li></ul><p>Below is a list of examples for common needs.
All examples are meant to be used in the <code>silta.yml</code> file of your project. Most of the examples work with both drupal chart and frontend chart, unless name is explicitly mentioned above the code snippet. Double-check with default value files for each chart - <a href="https://github.com/wunderio/charts/blob/master/drupal/values.yaml" target="_blank" rel="noopener noreferrer">drupal</a> and <a href="https://github.com/wunderio/charts/blob/master/frontend/values.yaml" target="_blank" rel="noopener noreferrer">frontend</a>.</p><p>Also note that increasing resources will result in increased costs, so use sensible values.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="allocate-more-storage-for-your-database"></a>Allocate more storage for your database.<a class="hash-link" href="#allocate-more-storage-for-your-database" title="Direct link to heading">#</a></h2><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mariadb</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">master</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">persistence</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2G</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that storage can only be increased, not decreased.</p><p>Note 2: If you change it for existing deployment, You&#x27;ll need to run special comands in cluster to expand the storage or deployment will fail (see <a href="/silta/docs/troubleshooting#mariadb-or-elasticsearch-running-out-of-disk-space">Mariadb or Elasticsearch running out of disk space</a> in troubleshooting page).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="using-different-version-of-mariadb-than-provided-in-chart-defaults"></a>Using different version of MariaDB than provided in chart defaults.<a class="hash-link" href="#using-different-version-of-mariadb-than-provided-in-chart-defaults" title="Direct link to heading">#</a></h2><p>While it&#x27;s normally not advised, it&#x27;s possible to adjust MariaDB image version -</p><p><em>Drupal chart and Frontend chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mariadb</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Available image tags listed at https://hub.docker.com/r/bitnami/mariadb/tags. Use debian images.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># tag: 10.10.6-debian-11-r25</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># tag: 10.11.5-debian-11-r24</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 11.0.3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">debian</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">11</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">r25</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>It&#x27;s highly suggested to create mysql data backup before image change.</p><p>Note: Do not change image to an earlier version, it may break the data.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="mount-drupal-public-files-to-a-different-location"></a>Mount Drupal public files to a different location<a class="hash-link" href="#mount-drupal-public-files-to-a-different-location" title="Direct link to heading">#</a></h2><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">public-files</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> `/app/web/sites/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">other</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">location/files`</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enabling-private-files-for-drupal"></a>Enabling private files for drupal<a class="hash-link" href="#enabling-private-files-for-drupal" title="Direct link to heading">#</a></h2><p>There is a pre-built mount template for drupal private file storage in silta (check values.yaml), you just have to enable it</p><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">private-files</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Enabling this will mount shared storage to <code>/app/private</code> and set <code>$settings[&#x27;file_private_path&#x27;]</code> accordingly. See chart values for override parameters.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="change-how-often-the-standard-drupal-cron-is-executed"></a>Change how often the standard Drupal cron is executed<a class="hash-link" href="#change-how-often-the-standard-drupal-cron-is-executed" title="Direct link to heading">#</a></h2><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">php</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cron</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">drupal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Run every 5 minutes</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">schedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*/5 * * * *&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deploy-a-custom-service-using-frontend-chart"></a>Deploy a custom service using frontend chart<a class="hash-link" href="#deploy-a-custom-service-using-frontend-chart" title="Direct link to heading">#</a></h2><p>While Frontend chart was originally meant to host NodeJS frontend projects, it also allows running custom docker images and optionally exposing them via nginx reverse proxy. These containers are called &quot;services&quot; in Frontend chart.</p><p>In this example, we are setting up two custom services - &quot;mynodeservice&quot; that will use a custom built image (see circleci configuration below) and &quot;mongo&quot; that will use prebuilt mongodb docker imageservice.</p><p>Note: This &quot;.Values.services.mongo&quot; service is not the same as &quot;.Values.mongodb&quot;, it&#x27;s just an example.</p><p><em>Frontend chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mynodeservice</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">VARIABLE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;VALUE&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Exposed at [hostname]/servicepath</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">exposedRoute</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/servicepath&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mongo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Mongo image does not need to be built,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># uses https://hub.docker.com/_/mongo</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">27017</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>See <code>.Values.serviceDefaults</code> for service default values.</p><p>Service images are built at <code>.circleci/config.yaml</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build_deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">silta/frontend-build-deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token important">&amp;build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deploy</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image_build_steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">silta/build-docker-image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">dockerfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;silta/mynodeservice.Dockerfile&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">identifier</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mynodeservice&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>It is very important to understand kubernetes containers are stateless, the moment container gets restarted, it will reset the storage to contents of docker image. To persist some particular filesystem path, you need to define persistent storage at <code>.Values.mounts</code> and attach it to the service (this only applies to containers defined at <code>.Values.services</code> since other applications (<code>.Values.mongodb</code>, <code>.Values.mariadb</code>, etc.) have default configurations in chart that persist data).</p><p>In this example, we are setting up a custom &quot;mongo&quot; service that will use prebuilt mongodb docker imageservice.</p><p>Note: This &quot;.Values.services.mongo&quot; service is not the same as &quot;.Values.mongodb&quot;, it&#x27;s just an example.</p><p><em>Frontend chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mongo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Mongo image does not need to be built,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># uses https://hub.docker.com/_/mongo</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mongodb</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Recreate</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mongodb-data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 5Gi</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data/db</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># GKE storage class</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> standard</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ReadWriteOnce</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><code>storageClassName</code> is only available on GKE. AWS and other cloud providers have different storageclasses, so it depends on cloud provider. There are several options and they differ by access (read / write) speed. <code>standard</code> is a safe choice.</li><li><code>accessModes</code> depends on storageClass. <code>standard</code> on GKE provides <code>ReadWriteOnce</code>. See <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes</a> for more information</li><li><code>.Values.services.mongo.strategy.type: Recreate</code> is required for &quot;read write once&quot; type storage mounts, because they only allow mounting storage once, but default strategy for services is <code>RollingUpdate</code> and it would fail deployment. See <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy</a> for more information.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="run-a-custom-cron-job"></a>Run a custom cron job<a class="hash-link" href="#run-a-custom-cron-job" title="Direct link to heading">#</a></h2><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">php</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cron</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">my-custom-cron-job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Run a custom drush command at midnight</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">schedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0 0 * * *&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;drush my-custom-command&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><em>Frontend chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">myservice</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cron</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">my-custom-cron-job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Run a custom command at midnight</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">schedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0 0 * * *&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my-custom-command&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="add-additional-environment-variables"></a>Add additional environment variables<a class="hash-link" href="#add-additional-environment-variables" title="Direct link to heading">#</a></h2><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">php</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">MY_VARIABLE_NAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;theValueOfMyVariable&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><em>Frontend chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">myservice</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MY_VARIABLE_NAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;theValueOfMyVariable&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="change-basic-auth-username-and-password"></a>Change basic auth username and password<a class="hash-link" href="#change-basic-auth-username-and-password" title="Direct link to heading">#</a></h2><p><em>Drupal chart and Frontend chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">basicauth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credentials</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hello</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> My$ecretP4ssw0rd</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enable-elasticsearch"></a>Enable elasticsearch<a class="hash-link" href="#enable-elasticsearch" title="Direct link to heading">#</a></h2><p><em>Drupal chart and Frontend chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">elasticsearch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="using-plugins-with-elasticsearch"></a>Using plugins with Elasticsearch<a class="hash-link" href="#using-plugins-with-elasticsearch" title="Direct link to heading">#</a></h2><p><strong>Create a custom elasticsearch dockerfile to silta/elasticsearch.Dockerfile:</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">ARG ES_VERSION=7.17.0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">FROM docker.elastic.co/elasticsearch/elasticsearch:${ES_VERSION}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">ARG ES_VERSION</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">USER root</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># Install Elasticsearch plugins</span></div><div class="token-line" style="color:#393A34"><span class="token plain">RUN elasticsearch-plugin install analysis-icu</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">USER elasticsearch</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Build the custom Elasticsearch image in CircleCI:</strong></p><p>When using <code>silta/drupal-build-deploy</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">      - silta/drupal-build-deploy:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          pre-release:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            - silta/build-docker-image:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                dockerfile: silta/elasticsearch.Dockerfile</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                tag: with-plugins</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                identifier: elasticsearch</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                expose_image: false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When using <code>silta/frontend-build-deploy</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">      - silta/frontend-build-deploy:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          image_build_steps:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            - silta/build-docker-image:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                dockerfile: silta/elasticsearch.Dockerfile</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                tag: with-plugins</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                identifier: elasticsearch</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                expose_image: false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Use the custom elasticsearch image in your silta helm charts file:</strong></p><p>The container URL could be found in the CircleCI container build information.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">elasticsearch:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  enabled: true</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  image: &lt;CONTAINER-URL&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  imageTag: &#x27;with-plugins&#x27;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  imagePullPolicy: Always</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enable-memcached"></a>Enable memcached<a class="hash-link" href="#enable-memcached" title="Direct link to heading">#</a></h2><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">memcached</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Adjust resources and arguments as needed</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">  resources:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    requests:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      cpu: 150m</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      memory: 1200M</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    limits:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      cpu: 250m</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      memory: 1500M</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  arguments:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    - /run.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    # MaxMemoryLimit, this should be less than the resources.limits.memory, or memcached will crash.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    - -m 1200</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    # MaxItemSize</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    - -I 16M</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Modify settings.php file (example is from D9)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">/**</span></div><div class="token-line" style="color:#393A34"><span class="token plain"> * Set the memcache server hostname when a memcached server is available.</span></div><div class="token-line" style="color:#393A34"><span class="token plain"> */</span></div><div class="token-line" style="color:#393A34"><span class="token plain">if (getenv(&quot;SILTA_CLUSTER&quot;) &amp;&amp; getenv(&#x27;MEMCACHED_HOST&#x27;)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  $settings[&#x27;memcache&#x27;][&#x27;servers&#x27;] = [getenv(&#x27;MEMCACHED_HOST&#x27;) . &#x27;:11211&#x27; =&gt; &#x27;default&#x27;];</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  // Set the default cache backend to use memcache if memcache host is set and</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  // if one of the memcache libraries was found. Cache backends should not be</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  // set to memcache during installation. The existence of the memcache drupal</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  // module should also be checked but this is not possible until this issue</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  // has been fixed: https://www.drupal.org/project/drupal/issues/2766509</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  if (!InstallerKernel::installationAttempted() &amp;&amp; (class_exists(&#x27;Memcache&#x27;, FALSE) || class_exists(&#x27;Memcached&#x27;, FALSE))) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $settings[&#x27;cache&#x27;][&#x27;default&#x27;] = &#x27;cache.backend.memcache&#x27;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  /**</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   * Memcache configuration.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   */</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  if (class_exists(&#x27;Memcached&#x27;, FALSE)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $settings[&#x27;memcache&#x27;][&#x27;extension&#x27;] = &#x27;Memcached&#x27;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // Memcached PECL Extension Support.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    $settings[&#x27;memcache&#x27;][&#x27;options&#x27;] = [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      // Enable compression for PHP 7.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      \Memcached::OPT_COMPRESSION =&gt; TRUE,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      \Memcached::OPT_DISTRIBUTION =&gt; \Memcached::DISTRIBUTION_CONSISTENT,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      // Decrease latency.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      \Memcached::OPT_TCP_NODELAY =&gt; TRUE,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ];</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>For D7 use</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">  if (getenv(&#x27;MEMCACHED_HOST&#x27;)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (class_exists(&#x27;Memcache&#x27;, FALSE) || class_exists(&#x27;Memcached&#x27;, FALSE)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      $conf[&#x27;memcache_servers&#x27;] = [getenv(&#x27;MEMCACHED_HOST&#x27;) . &#x27;:11211&#x27; =&gt; &#x27;default&#x27;];</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="using-varnish"></a>Using varnish<a class="hash-link" href="#using-varnish" title="Direct link to heading">#</a></h2><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">varnish</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If extra cookies are needed, they can be defined in a vcl_extra_cookies variable:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">varnish</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">vcl_extra_cookies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    if (req.http.Cookie ~ &quot;extra_cookie_name&quot;) {</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      return (pass);</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When varnish is enabled in silta config, drupal configuration needs to be adjusted, so purge can find the varnish server.</p><p><strong>Using <a href="https://www.drupal.org/project/varnish" target="_blank" rel="noopener noreferrer">varnish</a> module:</strong></p><p><em>You should consider using purge module instead</em>
No adjustments needed</p><p><strong>Using <a href="https://www.drupal.org/project/varnish_purge" target="_blank" rel="noopener noreferrer">varnish_purge</a> module:</strong></p><ol><li>Add varnish purger to purge settings.</li><li>Find purger configuration name. You can see it by hovering over the configuration link (i.e. <code>1b619ba479</code>). This will be Your <code>&lt;PURGER_ID&gt;</code>.</li><li>Put this snippet into your <code>settings.php</code> file:</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-php codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token single-quoted-string string" style="color:#e3116c">&#x27;SILTA_CLUSTER&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token single-quoted-string string" style="color:#e3116c">&#x27;VARNISH_ADMIN_HOST&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token variable" style="color:#36acaa">$config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token single-quoted-string string" style="color:#e3116c">&#x27;varnish_purger.settings.&lt;PURGER_ID&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token single-quoted-string string" style="color:#e3116c">&#x27;hostname&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token single-quoted-string string" style="color:#e3116c">&#x27;VARNISH_ADMIN_HOST&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token variable" style="color:#36acaa">$config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token single-quoted-string string" style="color:#e3116c">&#x27;varnish_purger.settings.&lt;PURGER_ID&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token single-quoted-string string" style="color:#e3116c">&#x27;port&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token single-quoted-string string" style="color:#e3116c">&#x27;80&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Make sure to replace <code>&lt;PURGER_ID&gt;</code> with an actual id of purger configuration!</p><p><strong>Changing varnish default control-key value</strong></p><p>This can be done by adding <code>secret</code> variable.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">varnish</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my-secret-key&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Please remember: best practice is to encrypt secrets.</p><p><strong>Changing varnish cache backend</strong></p><p>The current default cache backend is set to file storage. The setting is exposed in values file and can be changed. Here are few examples:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">varnish</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 768Mi</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Memory allocated storage. Make sure to adjust varnish memory allocation too (see above)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storageBackend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;malloc,512m&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Disc allocated storage.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storageBackend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;file,/var/lib/varnish/varnish_storage.bin,512M&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="using-redis"></a>Using Redis<a class="hash-link" href="#using-redis" title="Direct link to heading">#</a></h2><p>By default, redis service does not set max memory value. You can do it by setting flags:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">redis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">master</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">persistence</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2Gi</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">extraFlags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--maxmemory-policy allkeys-lru&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--maxmemory 1700mb&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="skip-taking-reference-data-dumps-on-each-deployment"></a>Skip taking reference data dumps on each deployment<a class="hash-link" href="#skip-taking-reference-data-dumps-on-each-deployment" title="Direct link to heading">#</a></h2><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">referenceData</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateAfterDeployment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>For some sites with a lot of files, taking a reference data dump after each deployment can cause the builds to time out. Disabling <code>updateAfterDeployment</code> means new environments will be created with reference data from the previous nightly dump.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="sending-e-mail"></a>Sending e-mail<a class="hash-link" href="#sending-e-mail" title="Direct link to heading">#</a></h2><p>Note: There is no e-mail handling for frontend chart. You must implement the smtp workflow via application.</p><p>If you just want to test email, you can use mailhog:</p><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mailhog</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Mailhog access information will be printed in release notes.</p><p>For emails to be actually sent out of the cluster, you can use any external smtp server. Here&#x27;s an example for sparkpost.</p><p><em>Drupal chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">smtp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> smtp.sparkpostmail.com</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">587 </span><span class="token comment" style="color:#999988;font-style:italic"># or smtp.eu.sparkpost.com:587</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># When using smtp.office365.com:587 instead of sparkpost both tls and starttls need to be set to &quot;YES&quot;.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># tls: &quot;YES&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># starttls: &quot;YES&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SMTP_Injection&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Encrypt this password. See: docs/encrypting_sensitive_configuration.md</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Please note that when using smtp.office365.com:587, password may not contain following special characters =, :, or #</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MYAPIKEY&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note: To get the sparkpost API key, you have to <a href="https://www.sparkpost.com/docs/getting-started/setting-up-domains/" target="_blank" rel="noopener noreferrer">validate your domain</a> first.</p><p>Note 2: Because of <a href="https://serverfault.com/questions/826875/what-characters-are-illegal-in-password-in-ssmtp-conf" target="_blank" rel="noopener noreferrer">long-standing bugs in the ssmtp package</a>, the smtp password cannot contain the special characters <code>#</code>, <code>=</code> or <code>:</code>.</p><p>If the <code>smtp</code> is configured and enabled, but it does not appear to send anything, make sure <code>mailhog</code> is not enabled.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="domain-names-and-ssl-certificates"></a>Domain names and SSL certificates<a class="hash-link" href="#domain-names-and-ssl-certificates" title="Direct link to heading">#</a></h2><p>All environments are given a hostname by default. It is possible to attach a custom domain name to environment by configuring <code>exposeDomains</code> configuration parameter. All hostnames attached to environment are printed in release notes.<br>
You can also use <code>letsencrypt-staging</code> issuer to avoid hitting <code>letsencrypt</code> <a href="https://letsencrypt.org/docs/rate-limits/" target="_blank" rel="noopener noreferrer">rate limits</a>.</p><p>!NB Deploy <code>exposeDomains</code> entries only when DNS entries are changed or are soon to be changed. Otherwise, Letsencrypt validation might eventually get stuck due to retries.</p><p>!NB Put <code>exposeDomains</code> in a dedicated configuration yaml file, so only one environment (branch) would be assigned this hostname. Having multiple environments with the same domain will act as a round robin load balancer for all environments and unexpected responses might be returned.</p><p><em>Drupal chart and Frontend chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">exposeDomains</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">example-le</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ssl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">le.example.com</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ssl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">issuer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> letsencrypt</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">example-customcert</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ssl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">custom.example.com</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ssl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">issuer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> custom</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Encrypt key and certificate. See: docs/encrypting_sensitive_configuration.md</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        -----BEGIN RSA PRIVATE KEY-----</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &lt;KEY&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        -----END RSA PRIVATE KEY-----</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">crt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        -----BEGIN CERTIFICATE-----</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &lt; DOMAIN CERTIFICATE &gt;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        -----END CERTIFICATE-----</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        -----BEGIN CERTIFICATE-----</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &lt; INTERMEDIATE CERTIFICATE &gt;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        -----END CERTIFICATE-----</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        -----BEGIN CERTIFICATE-----</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &lt; ROOT CA CERTIFICATE &gt;</span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        -----END CERTIFICATE-----</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>key</code> value is certificates private key.<br>
<code>crt</code> value is full chain of certificate.<br>
<code>ca</code> value is not required anymore for exposed domains.<br>
<a href="/silta/docs/ssl_certificates">See more information on how to convert and prepare SSL certificate for exposed domains</a></p><p>If you have same SSL certificate for multiple domains You can reuse <code>ssl</code> block. </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">exposeDomains</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">example-domain1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token important">&amp;shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssl</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ssl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">example-domain2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&lt;&lt;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token important">*shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssl</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">example-domain3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&lt;&lt;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token important">*shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssl</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You don&#x27;t need a custom static ip (via gce ingress) normally, but if Your project requires, here&#x27;s how -</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">exposeDomains</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">example-gce-ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gce</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ingress.example.com</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># see ingress.gce definition. This can also be a custom ingress too.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gce</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ssl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">issuer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> letsencrypt</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gce</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Request a global static ip from OPS team first</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">staticIpAddressName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> custom</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ip</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Reverse proxy IP&#x27;s to trust with contents of X-Forwarded-For header</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">realipfrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gke-internal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.0.0.0/8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Load Balancer IP (static ip you were given)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gce-lb-ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.2.3.4/32;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Depending on the cluster type, You might need to enable this.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># A safe default is &quot;false&quot; (works in both cases), but &quot;VPC Native&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># clusters work more correcly with cluster.vpcNative set to &quot;true&quot;.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">cluster</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">vpcNative</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="add-redirects"></a>Add redirects<a class="hash-link" href="#add-redirects" title="Direct link to heading">#</a></h2><p>Redirects can be relative to current domain or contain full domain for more targeted redirects when multiple external domains (<code>exposeDomains</code>) are attached to deployment, and you only need this redirect for a specific URL.</p><p>If you are scattering the redirect rules into separate yaml&#x27;s, use keys (or the latter yaml will overwrite the whole <code>nginx.redirects</code> object) and the alphabetical order of keys will be respected in the nginx redirect map. Because of this, it&#x27;s better to put everything in one file without keys, just descriptions and the order of the yaml will be respected.</p><p>Each redirect has <code>from</code> and <code>to</code> keys, and an optional <code>description</code> key, which does not do anything currently, it&#x27;s a documentation comment for configuration maintainer.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="from"></a><code>from</code><a class="hash-link" href="#from" title="Direct link to heading">#</a></h4><p>By default, strings are matched using case-insensitive exact matching.</p><p>Regular expressions can be used by prefixing the value with <code>~</code> for a case-sensitive matching, or with <code>~*</code> for case-insensitive matching. Regular expressions can contain named and positional captures that can be referenced in the <code>to</code> value.</p><p>Make sure to use proper anchors (<code>^</code> and <code>$</code>) and character escaping in regular expressions, to get exactly the match you want and nothing extra.</p><ul><li>Bad example: <code>from: &#x27;~/old-page</code> matches any string containing <code>/old-page</code>, e.g. <code>/anypath/old-page</code> or <code>/old-page/anypath</code> or even <code>/valid/path?/old-page</code>.</li><li>Good example: <code>from: ~^/old-page/.+\.html</code> matches specifically path <code>/old-page/*.html</code>.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="to"></a><code>to</code><a class="hash-link" href="#to" title="Direct link to heading">#</a></h4><p>Can include references to captured values from regular expressions, and special <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#variables" target="_blank" rel="noopener noreferrer">nginx variables</a> like <code>$request_uri</code>or <code>$query_string</code>.</p><p><em>Drupal chart and Frontend chart</em>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">redirects</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Redirect exact path match to another path on same the domain.&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/old-page&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/new-page&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Redirect exact path match to another path on another the domain.&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/old-page&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://another-domain.example.com/new-page&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Redirect exact url match to another path on same the domain. Note: Matching using https does not work because of SSL/TLS offloading.&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://example.com/old-page&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/new-page&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Redirect all non-www requests to www, keeping the request path intact.&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;~^http://example\.com&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://www.example.com$request_uri&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Redirect exact url, matching both www and non-www.&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;~http://(www\.)?example\.com/old-page$&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/new-page&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Redirect case-insensitive url match.&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;~*http://www\.example\.com/oLd-pAgE$&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/new-page&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Redirect regex match, using positional capturing groups.&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;~^/old-articles/(.+)/view/(\d+)$&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/new-articles/$1/?article_id=$2&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Redirect regex match, using named capturing groups.&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;~^/old-articles/(?&lt;date&gt;.+)/view/(?&lt;id&gt;\d+)$&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/new-articles/$date/?article_id=$id&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="allowing-cross-namespace--cross-deployment-connections"></a>Allowing cross-namespace / cross-deployment connections<a class="hash-link" href="#allowing-cross-namespace--cross-deployment-connections" title="Direct link to heading">#</a></h2><p>Resources in Silta charts are protected by <a href="https://projectcalico.docs.tigera.io/security/calico-network-policy" target="_blank" rel="noopener noreferrer">Calico NetworkPolicy</a> rules. Rules are defined in helm <code>.Values.silta-release.ingressAccess</code> configuration object. There are few default rules that deny access to all pods in deployment from other deployments, but it is also possible to add extra [NetworkPolicy rules] (<a href="https://projectcalico.docs.tigera.io/security/policy-rules" target="_blank" rel="noopener noreferrer">https://projectcalico.docs.tigera.io/security/policy-rules</a>) to selecively allow access to deployment resources.</p><p>Here are few examples:</p><ol><li>Allowing access to pods from another namespace:</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">silta-release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ingressAccess</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Allow Frontend access to Drupal via internal connection </span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">allow-drupal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">additionalPodSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> drupal</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">namespaceSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> frontend</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ns</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="2"><li>Allow direct elasticsearch access from frontend namespace </li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">silta-release:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  # Allow Frontend access to elasticsearch via internal connection </span></div><div class="token-line" style="color:#393A34"><span class="token plain">  allowESaccess:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    additionalPodSelector:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      chart: elasticsearch</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    from:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      - namespaceSelector:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          matchLabels:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              name: frontend-ns</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="3"><li>Allow CIDR access to service (routed connection only, does not work with NAT&#x27;ted connections)</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">silta-release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Allow Azure Application Gateway to drupal service</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ingressAccess</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">CustomAzureAppGWAccess</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ipBlock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cidr</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.2.3.4/5</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="add-custom-include-files-for-nginx"></a>Add custom include files for nginx<a class="hash-link" href="#add-custom-include-files-for-nginx" title="Direct link to heading">#</a></h2><p>Drupal chart builds nginx container using web/ folder as build context. This prevents files being included from outside the web folder and it&#x27;s not a good idea to put config files under it.
To be able to add include files the build context needs to be changed from <code>web/</code> into <code>.</code> by passing <code>nginx_build_context: &quot;.&quot;</code> to <code>drupal-docker-build</code> in <code>.circleci/config.yml</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">silta/drupal-docker-build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nginx_build_context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Due root containing Drupal / shell container compatible .dockerignore file and for frontend there is a separate one inside the web/ folder this doesn&#x27;t work anymore. Since version 19.03 Docker supports separate .dockerignore files for each Dockerfile. This requires Docker build to be made with BuildKit enabled. To enable BuildKit just pass the <code>DOCKER_BUILDKIT=1</code> to the build environment as an environment variable:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">DOCKER_BUILDKIT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The ignore file itself needs to be named the same as the Dockerfile with .dockerignore appended to the end and need to reside at the same place as the Dockerfile:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> web/.gitignore silta/nginx.Dockerfile.dockerignore</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note: our validation checks if the .dockerignore is present under web/ so you can either leave it there or just add an empty file in it&#x27;s place.
To make the image to build correctly in this new context you need to update the COPY command in the nginx.Dockerfile to copy <code>web</code> instead of <code>.</code> and also add COPY commands to any custom config files you want to be able to include:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">COPY silta/nginx.serverextra.conf /etc/nginx</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">COPY web /app/web</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now you can include the config file in silta.yml like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serverExtraConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    include nginx.serverextra.conf;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>or if you <code>COPY</code> the file under <code>/etc/nginx/conf.d</code> they will be included automatically without the need to add them to silta.yml configs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deploy-sub-project-from-the-same-repo-using-simple-chart"></a>Deploy sub-project from the same repo using simple chart<a class="hash-link" href="#deploy-sub-project-from-the-same-repo-using-simple-chart" title="Direct link to heading">#</a></h2><p>Having e.g. Storybook or other frontend application included in the base project codebase that require
separate deployment can be easily done even using different chart.
See <a href="/silta/docs/circleci-conf-examples">https://wunderio.github.io/silta/docs/circleci-conf-examples</a> for the deployment setup part.</p><p>When using different charts (e.g. drupal and simple) you need to separate chart specific configurations to their own silta-*.yml files if you want to share any configs between the application deployments (for example basic auth credentials). Best way to do it is to put only the shared configurations to the silta.yml file and have e.g. silta-cms.yml and silta-storybook.yml for application specific configurations.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="add-custom-subcharts-to-deployment"></a>Add custom subcharts to deployment<a class="hash-link" href="#add-custom-subcharts-to-deployment" title="Direct link to heading">#</a></h2><ol><li>In <code>silta</code> folder, create <code>extra_charts.yml</code> which contains list of subcharts to add.</li></ol><p>Following examples add a redis subchart to drupal chart deployment.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">charts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 16.8.x</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">repository</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//charts.bitnami.com/bitnami</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis.enabled</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To use a local subchart, replace repository link with <code>file://&lt;path&gt;/&lt;to&gt;/&lt;subchart&gt;</code></p><ol start="2"><li>Add these 2 parameters to <code>drupal-deploy</code> CircleCI job:</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">silta/drupal-deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">source_chart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wunderio/drupal</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">extension_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> silta/extra_charts.yml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="3"><li>If desired, modify variables for the subchart in <code>silta.yml</code> under the key of subcharts&#x27; name. For example above, it&#x27;s <code>redis</code>.</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">..</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">redis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><em>Sets redis password to test</em></p><p>Notice the <code>condition</code> key in <code>extra_charts.yml</code> for the redis subchart. It makes it possible to deploy this subchart conditionally, when <code>redis: enabled</code> is passed in <code>silta.yml</code>. </p><p>Delete the <code>condition: redis.enabled</code> line if you want this subchart installed in all your future deployments, regardless of settings in <code>silta.yml</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/wunderio/silta/tree/master/docs/silta-examples.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/silta/docs/configuring-cdn"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Configuring CDN</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/silta/docs/troubleshooting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Troubleshooting and FAQ »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#siltayml-configuration-examples" class="table-of-contents__link">silta.yml configuration examples</a></li><li><a href="#allocate-more-storage-for-your-database" class="table-of-contents__link">Allocate more storage for your database.</a></li><li><a href="#using-different-version-of-mariadb-than-provided-in-chart-defaults" class="table-of-contents__link">Using different version of MariaDB than provided in chart defaults.</a></li><li><a href="#mount-drupal-public-files-to-a-different-location" class="table-of-contents__link">Mount Drupal public files to a different location</a></li><li><a href="#enabling-private-files-for-drupal" class="table-of-contents__link">Enabling private files for drupal</a></li><li><a href="#change-how-often-the-standard-drupal-cron-is-executed" class="table-of-contents__link">Change how often the standard Drupal cron is executed</a></li><li><a href="#deploy-a-custom-service-using-frontend-chart" class="table-of-contents__link">Deploy a custom service using frontend chart</a></li><li><a href="#run-a-custom-cron-job" class="table-of-contents__link">Run a custom cron job</a></li><li><a href="#add-additional-environment-variables" class="table-of-contents__link">Add additional environment variables</a></li><li><a href="#change-basic-auth-username-and-password" class="table-of-contents__link">Change basic auth username and password</a></li><li><a href="#enable-elasticsearch" class="table-of-contents__link">Enable elasticsearch</a></li><li><a href="#using-plugins-with-elasticsearch" class="table-of-contents__link">Using plugins with Elasticsearch</a></li><li><a href="#enable-memcached" class="table-of-contents__link">Enable memcached</a></li><li><a href="#using-varnish" class="table-of-contents__link">Using varnish</a></li><li><a href="#using-redis" class="table-of-contents__link">Using Redis</a></li><li><a href="#skip-taking-reference-data-dumps-on-each-deployment" class="table-of-contents__link">Skip taking reference data dumps on each deployment</a></li><li><a href="#sending-e-mail" class="table-of-contents__link">Sending e-mail</a></li><li><a href="#domain-names-and-ssl-certificates" class="table-of-contents__link">Domain names and SSL certificates</a></li><li><a href="#add-redirects" class="table-of-contents__link">Add redirects</a></li><li><a href="#allowing-cross-namespace--cross-deployment-connections" class="table-of-contents__link">Allowing cross-namespace / cross-deployment connections</a></li><li><a href="#add-custom-include-files-for-nginx" class="table-of-contents__link">Add custom include files for nginx</a></li><li><a href="#deploy-sub-project-from-the-same-repo-using-simple-chart" class="table-of-contents__link">Deploy sub-project from the same repo using simple chart</a></li><li><a href="#add-custom-subcharts-to-deployment" class="table-of-contents__link">Add custom subcharts to deployment</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/silta/docs/">Style Guide</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social presence</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/wunder.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/wunder.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin</a></li><li class="footer__item"><a href="https://twitter.com/Wunder_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.instagram.com/wunder.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCsBoaJt5sX12IFBu1giXZJg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://wunder.io/articles/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/wunderio/silta" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Wunder</div></div></div></footer></div>
<script src="/silta/styles.4d755ee7.js"></script>
<script src="/silta/runtime~main.c8bce8dc.js"></script>
<script src="/silta/main.f8febef0.js"></script>
<script src="/silta/1.5f155a16.js"></script>
<script src="/silta/2.429058cd.js"></script>
<script src="/silta/33.42ebe109.js"></script>
<script src="/silta/36.772ffc42.js"></script>
<script src="/silta/935f2afb.6572eb8b.js"></script>
<script src="/silta/17896441.7736293f.js"></script>
<script src="/silta/5a2b91a1.f6c4c79f.js"></script>
</body>
</html>