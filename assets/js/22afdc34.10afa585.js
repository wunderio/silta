"use strict";(self.webpackChunksilta_docs=self.webpackChunksilta_docs||[]).push([[184],{7007:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"multiple_private_repositories","title":"Documentation: Using Multiple Private Repositories with CircleCI and Silta","description":"Overview","source":"@site/docs/multiple_private_repositories.md","sourceDirName":".","slug":"/multiple_private_repositories","permalink":"/silta/docs/multiple_private_repositories","draft":false,"unlisted":false,"editUrl":"https://github.com/wunderio/silta/tree/master/docs/multiple_private_repositories.md","tags":[],"version":"current","frontMatter":{}}');var r=s(4848),n=s(8453);const o={},l="Documentation: Using Multiple Private Repositories with CircleCI and Silta",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Problem Statement",id:"problem-statement",level:2},{value:"Solution",id:"solution",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step-by-Step Implementation",id:"step-by-step-implementation",level:2},{value:"1. Generate SSH Key Pairs",id:"1-generate-ssh-key-pairs",level:3},{value:"2. Add Private Keys to CircleCI",id:"2-add-private-keys-to-circleci",level:3},{value:"3. Add Public Keys to GitHub Repositories",id:"3-add-public-keys-to-github-repositories",level:3},{value:"4. Configure CircleCI Workflow",id:"4-configure-circleci-workflow",level:3},{value:"How It Works",id:"how-it-works",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"documentation-using-multiple-private-repositories-with-circleci-and-silta",children:"Documentation: Using Multiple Private Repositories with CircleCI and Silta"})}),"\n",(0,r.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(i.p,{children:"This document outlines the process for configuring CircleCI to access multiple private GitHub repositories when building and deploying a project with Silta. This is particularly useful when your project depends on private packages or repositories that require separate authentication."}),"\n",(0,r.jsx)(i.h2,{id:"problem-statement",children:"Problem Statement"}),"\n",(0,r.jsx)(i.p,{children:"By default, CircleCI can only authenticate with a single GitHub repository using the default deploy key. When your project depends on multiple private repositories (e.g., through Composer dependencies), additional SSH keys must be configured to allow access to these repositories."}),"\n",(0,r.jsx)(i.h2,{id:"solution",children:"Solution"}),"\n",(0,r.jsx)(i.p,{children:"We use CircleCI's SSH key management combined with SSH host aliases to allow Composer to authenticate with multiple private GitHub repositories."}),"\n",(0,r.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"A CircleCI project connected to your GitHub repository"}),"\n",(0,r.jsx)(i.li,{children:"Admin access to the GitHub repositories you need to access"}),"\n",(0,r.jsx)(i.li,{children:"Basic understanding of SSH keys and Composer"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"step-by-step-implementation",children:"Step-by-Step Implementation"}),"\n",(0,r.jsx)(i.h3,{id:"1-generate-ssh-key-pairs",children:"1. Generate SSH Key Pairs"}),"\n",(0,r.jsx)(i.p,{children:"For each private repository you need to access, generate a unique SSH key pair:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:'# Create a key for each private repository\nssh-keygen -t ed25519 -f ~/.ssh/repo1_key -C "circleci-repo1"\nssh-keygen -t ed25519 -f ~/.ssh/repo2_key -C "circleci-repo2"\n'})}),"\n",(0,r.jsx)(i.h3,{id:"2-add-private-keys-to-circleci",children:"2. Add Private Keys to CircleCI"}),"\n",(0,r.jsx)(i.p,{children:"For each key:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Go to your CircleCI project settings: ",(0,r.jsx)(i.code,{children:"https://app.circleci.com/settings/project/github/[org]/[project]/ssh"})]}),"\n",(0,r.jsx)(i.li,{children:'Click "Add SSH Key"'}),"\n",(0,r.jsxs)(i.li,{children:["Enter a hostname alias (e.g., ",(0,r.jsx)(i.code,{children:"github-repo1"}),", ",(0,r.jsx)(i.code,{children:"github-repo2"}),") - these will be used in SSH config"]}),"\n",(0,r.jsxs)(i.li,{children:["Paste the private key content (from ",(0,r.jsx)(i.code,{children:"~/.ssh/repo1_key"}),", ",(0,r.jsx)(i.code,{children:"~/.ssh/repo2_key"}),", etc.)"]}),"\n",(0,r.jsx)(i.li,{children:"Save the key"}),"\n",(0,r.jsx)(i.li,{children:"Note the fingerprint of each added key (displayed in the UI)"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"3-add-public-keys-to-github-repositories",children:"3. Add Public Keys to GitHub Repositories"}),"\n",(0,r.jsx)(i.p,{children:"For each private repository:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Go to the repository settings: ",(0,r.jsx)(i.code,{children:"https://github.com/[org]/[repo-name]/settings/keys"})]}),"\n",(0,r.jsx)(i.li,{children:'Click "Add deploy key"'}),"\n",(0,r.jsx)(i.li,{children:'Give it a descriptive title (e.g., "CircleCI Access")'}),"\n",(0,r.jsxs)(i.li,{children:["Paste the public key content (from ",(0,r.jsx)(i.code,{children:"~/.ssh/repo1_key.pub"}),", ",(0,r.jsx)(i.code,{children:"~/.ssh/repo2_key.pub"}),", etc.)"]}),"\n",(0,r.jsx)(i.li,{children:'Enable "Allow write access" if your build needs to push to the repository'}),"\n",(0,r.jsx)(i.li,{children:'Click "Add key"'}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"4-configure-circleci-workflow",children:"4. Configure CircleCI Workflow"}),"\n",(0,r.jsxs)(i.p,{children:["Update your ",(0,r.jsx)(i.code,{children:".circleci/config.yml"})," to use the SSH keys and configure the SSH client:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-yaml",children:"jobs:\n  build:\n    steps:\n      # Add all the SSH keys you registered\n      - add_ssh_keys:\n          fingerprints:\n            - \"SHA256:fingerprint_for_repo1_key\"\n            - \"SHA256:fingerprint_for_repo2_key\"\n            \n      # Configure SSH and update Composer references\n      - run:\n          name: Configure SSH for multiple repositories\n          command: |\n            # Configure SSH to use the correct keys for each host alias\n            sed -i '/Host github-repo1/a\\  HostName github.com' ~/.ssh/config\n            sed -i '/Host github-repo2/a\\  HostName github.com' ~/.ssh/config\n            \n            # Update repository URLs in composer files to use the host aliases\n            sed -i 's|git@github.com:wunderio/repo1.git|git@github-repo1:wunderio/repo1.git|g' composer.json\n            sed -i 's|git@github.com:wunderio/repo1.git|git@github-repo1:wunderio/repo1.git|g' composer.lock\n            sed -i 's|git@github.com:wunderio/repo2.git|git@github-repo2:wunderio/repo2.git|g' composer.json\n            sed -i 's|git@github.com:wunderio/repo2.git|git@github-repo2:wunderio/repo2.git|g' composer.lock\n      \n      # Continue with your build steps\n      - run:\n          name: Install dependencies\n          command: composer install\n"})}),"\n",(0,r.jsx)(i.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"SSH Key Management"}),": CircleCI loads the specified SSH keys into the SSH agent."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Host Aliases"}),": By configuring SSH host aliases (",(0,r.jsx)(i.code,{children:"github-repo1"}),", ",(0,r.jsx)(i.code,{children:"github-repo2"}),'), we create separate "virtual hosts" that all point to ',(0,r.jsx)(i.code,{children:"github.com"})," but use different SSH keys."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"URL Rewriting"}),": We modify the repository URLs in ",(0,r.jsx)(i.code,{children:"composer.json"})," and ",(0,r.jsx)(i.code,{children:"composer.lock"})," to use these host aliases instead of the default ",(0,r.jsx)(i.code,{children:"github.com"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Authentication"}),": When Composer tries to access a private repository, it uses the corresponding host alias, which triggers SSH to use the correct key for authentication."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"SSH Key Issues"}),": Verify that the fingerprints in your CircleCI config match the keys added in the CircleCI settings."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Access Denied"}),": Ensure the public keys are correctly added to each GitHub repository."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"URL Rewriting"}),": Check that all repository URLs are correctly updated in both ",(0,r.jsx)(i.code,{children:"composer.json"})," and ",(0,r.jsx)(i.code,{children:"composer.lock"}),"."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Generate unique keys for each repository to limit the scope of access if a key is compromised."}),"\n",(0,r.jsx)(i.li,{children:"Regularly rotate SSH keys as part of your security practices."}),"\n",(0,r.jsx)(i.li,{children:"Only grant write access to repositories when absolutely necessary."}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://wunderio.github.io/silta/",children:"Silta Documentation"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://circleci.com/docs/2.0/add-ssh-key/",children:"CircleCI SSH Key Management"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://docs.github.com/en/developers/overview/managing-deploy-keys",children:"GitHub Deploy Keys"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,n.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,i,s)=>{s.d(i,{R:()=>o,x:()=>l});var t=s(6540);const r={},n=t.createContext(r);function o(e){const i=t.useContext(n);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(n.Provider,{value:i},e.children)}}}]);