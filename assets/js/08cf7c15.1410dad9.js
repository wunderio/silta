"use strict";(self.webpackChunksilta_docs=self.webpackChunksilta_docs||[]).push([[904],{7457:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"circleci-conf-examples","title":"CircleCI configuration examples","description":"Our custom CircleCI Orb is located here//github.com/wunderio/silta-circleci/tree/master/orb","source":"@site/docs/circleci-examples.md","sourceDirName":".","slug":"/circleci-conf-examples","permalink":"/silta/docs/circleci-conf-examples","draft":false,"unlisted":false,"editUrl":"https://github.com/wunderio/silta/tree/master/docs/circleci-examples.md","tags":[],"version":"current","frontMatter":{"id":"circleci-conf-examples","title":"CircleCI configuration examples"},"sidebar":"someSidebar","previous":{"title":"Silta project build process","permalink":"/silta/docs/anatomy-of-silta"},"next":{"title":"Creating a new project","permalink":"/silta/docs/creating-new-project"}}');var i=o(4848),l=o(8453);const s={id:"circleci-conf-examples",title:"CircleCI configuration examples"},r=void 0,a={},c=[{value:"Run <code>npm install</code> from another location",id:"run-npm-install-from-another-location",level:2},{value:"Run a different command to build the frontend",id:"run-a-different-command-to-build-the-frontend",level:2},{value:"Use npm instead of yarn",id:"use-npm-instead-of-yarn",level:2},{value:"Deploy sub-project from within the same repo",id:"deploy-sub-project-from-within-the-same-repo",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Our custom CircleCI Orb is located here: ",(0,i.jsx)(n.a,{href:"https://github.com/wunderio/silta-circleci/tree/master/orb",children:"https://github.com/wunderio/silta-circleci/tree/master/orb"})]}),"\n",(0,i.jsxs)(n.p,{children:["Below is a list of examples for common needs.\nAll examples are meant to be used in the ",(0,i.jsx)(n.code,{children:".circleci/.yml"})," file of your project."]}),"\n",(0,i.jsxs)(n.h2,{id:"run-npm-install-from-another-location",children:["Run ",(0,i.jsx)(n.code,{children:"npm install"})," from another location"]}),"\n",(0,i.jsxs)(n.p,{children:["We recommend putting your package.json in the Drupal root folder (one level above the web root),\nbut many existing projects still have package.json in the theme folder.\nYou can specify the path to your frontend folder by adding a parameter to the\nexisting ",(0,i.jsx)(n.code,{children:"npm-install-build"})," command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"- npm-install-build:\n    path: web/themes/custom/mytheme\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note that this path is relative to the Drupal root, not to the project root."}),"\n",(0,i.jsx)(n.h2,{id:"run-a-different-command-to-build-the-frontend",children:"Run a different command to build the frontend"}),"\n",(0,i.jsxs)(n.p,{children:["The default command for building the frontend is ",(0,i.jsx)(n.code,{children:"npm run build"}),", assuming there will be a ",(0,i.jsx)(n.code,{children:"build"})," key\nin the ",(0,i.jsx)(n.code,{children:"script"})," section of your package.json, which is recommended."]}),"\n",(0,i.jsxs)(n.p,{children:["If you have another command that should be run you can specify it in the ",(0,i.jsx)(n.code,{children:"npm-install-build"})," step:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'- npm-install-build:\n    build-command: "compass compile --production"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"use-npm-instead-of-yarn",children:"Use npm instead of yarn"}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"npm"})," is preferred over the user of ",(0,i.jsx)(n.code,{children:"yarn"}),", and if it's not too much hassle it would be best to switch\nfor the sake of consistency.\nIn the meantime you can use the ",(0,i.jsx)(n.code,{children:"yarn-install-build"})," step which works the same as ",(0,i.jsx)(n.code,{children:"npm-install-build"})]}),"\n",(0,i.jsx)(n.h2,{id:"deploy-sub-project-from-within-the-same-repo",children:"Deploy sub-project from within the same repo"}),"\n",(0,i.jsx)(n.p,{children:"Having e.g. Storybook or other frontend application included in the base project codebase that require\nseparate deployment can be easily done even using different chart.\nFor simple application (static) the simple chart can be used. Refer to simple examples with the following additions:"}),"\n",(0,i.jsxs)(n.p,{children:["Tell build process (",(0,i.jsx)(n.code,{children:"under silta/simple-build-deploy"}),") where your application code can be found (related to repo root).\nIf the command to build your application isn't the default ",(0,i.jsx)(n.code,{children:"npm run build"}),"you can define it with the ",(0,i.jsx)(n.code,{children:"build_command"})," parameter."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"codebase-build:\n  - silta/npm-install-build:\n      path: web/themes/custom/yourtheme\n      build-command: npm run build && npm run build-storybook\n"})}),"\n",(0,i.jsx)(n.p,{children:"Next, you need to define the webroot of your application, e.g. where your application was built:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"build_folder: web/themes/custom/yourtheme/storybook-static\n"})}),"\n",(0,i.jsx)(n.p,{children:"Finally, give the deployment a release-suffix:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"release-suffix: storybook\n"})}),"\n",(0,i.jsx)(n.p,{children:"The complete deployment workflow for the app should look something like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"- silta/simple-build-deploy: &build-deploy\n    name: Storybook build & deploy\n    context: silta_dev\n    silta_config: silta/silta.yml,silta/silta-storybook.yml\n    release-suffix: storybook\n    build_folder: web/themes/custom/yourtheme/storybook-static\n    codebase-build:\n      - silta/npm-install-build:\n          path: web/themes/custom/yourtheme\n          build-command: npm run build && npm run build-storybook\n    filters:\n      branches:\n        ignore: production\n\n- silta/simple-build-deploy:\n    # Extend the build-deploy configuration for the production environment.\n    <<: *build-deploy\n    name: Storybook build & deploy production\n    context: silta_finland\n    silta_config: silta/silta.yml,silta/silta-storybook.yml,silta/silta-storybook-prod.yml\n    filters:\n      branches:\n        only: production\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note: you need to include the application specific silta_configs (here silta-storybook.yml and silta-storybook-prod.yml).\nYou should also update the drupal specific deployment steps to include the appropriate silta-cms.yml files."}),"\n",(0,i.jsxs)(n.p,{children:["Note 2: Add nested silta configurations (i.e. ",(0,i.jsx)(n.code,{children:"web/themes/custom/yourtheme/silta/"}),") and non-public files located in web subdirectory to ",(0,i.jsx)(n.code,{children:".dockerignore"})," file, to exclude them from nginx and php images."]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/silta/docs/silta-examples",children:"https://wunderio.github.io/silta/docs/silta-examples"})," for example on how to split the silta configuration part for this kind of setup.\nThere is also a more complex example in [",(0,i.jsx)(n.a,{href:"https://github.com/wunderio/decoupled-project%5D(decoupled-project",children:"https://github.com/wunderio/decoupled-project](decoupled-project"})," -template)"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>r});var t=o(6540);const i={},l=t.createContext(i);function s(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);